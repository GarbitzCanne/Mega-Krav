<!DOCTYPE html>
<html dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport"
 content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>

<title>Mega Krav Mobile</title>

<style>
body{
 background:#050505;
 color:#33ff33;
 font-family:monospace;
 margin:0;
}

#app{
 max-width:480px;
 margin:auto;
 padding:10px;
}

/* ===== TIME BAR ===== */
#timeBarBox{
 width:100%;
 height:18px;
 border:2px solid #33ff33;
 margin-bottom:8px;
}

#timeBar{
 height:100%;
 width:100%;
 background:#33ff33;
 transition:width 0.05s linear;
}

/* ===== SCREEN ===== */
#screen{
 border:2px solid #117711;
 background:#001100;
 padding:12px;
 min-height:24vh;
 white-space:pre-line;
 font-size:18px;
 margin-bottom:8px;
}

.btn{
 display:block;
 width:100%;
 margin:6px 0;
 padding:16px;

 background:#002200;
 color:#33ff33;

 border:2px solid #33ff33;
 border-radius:10px;

 font-size:22px;
}

.btn:active{
 background:#004400;
}

/* ===== 8BIT ART ===== */
.win{ color:#ffff33; }
.lose{ color:#33ff33; }
.korban{ color:#ff3366; }

.art{
 font-size:16px;
 line-height:1.1;
 text-align:center;
 margin:6px 0;
}
</style>
</head>

<body>
<div id="app">

<div id="timeBarBox">
 <div id="timeBar"></div>
</div>

<div id="screen"></div>
<div id="buttons"></div>

</div>

<script>
// ===== STATE =====
let stage = 0;
let round = 1;
let balbalot = false;

let barTimer;
let barWidth = 100;
let barSpeed = 3;   // grows with rounds

let playerMove,cpuMove;

// ===== DATA =====
const ARENA={
 "":"",
 "驻专":"",
 "爪":"驻专",
 "":"爪"
};

const BAL={
 "":"",
 "驻专":"",
 "爪":"驻专",
 "":"爪"
};

// ===== DECOYS =====
const DECOY_BANK={
 " 拽专":[" 拽专","注 拽专"," 拽专"],
 "住驻专 拽专":["住驻专 拽专","住驻 拽专","住驻专 专"],
 " 专":[" 专","注 专"," 专"],
 "住驻专 专":["住驻专 专","住驻 专","住驻专 专"],
 "转拽 转拽":["拽 转拽","转拽 转拽","拽 拽"],
 "驻专 注住":["驻专 住","驻专 注砖","驻转专 注住"]
};

function getDecoys(w){
 return DECOY_BANK[w] || [w+"!", w+"?", w+"*"];
}

// ===== RENDER =====
function show(t){
 document.getElementById("screen").innerHTML=t;
}

function renderButtons(list){
 let h="";
 list.forEach(b=>{
  h+=`<div class='btn'
       onclick="handle('${b.t}',${b.ok})">
       ${b.t}
      </div>`;
 });
 document.getElementById("buttons").innerHTML=h;
}

// ===== TIME BAR =====
function startBar(){

 clearInterval(barTimer);

 barWidth = 100;
 const bar = document.getElementById("timeBar");

 bar.style.width="100%";
 bar.style.background="#33ff33";

 barTimer=setInterval(()=>{

  barWidth -= barSpeed;

  bar.style.width = barWidth+"%";

  // color shift
  if(barWidth<50) bar.style.background="#ffaa00";
  if(barWidth<25) bar.style.background="#ff3333";

  if(barWidth<=0){
   korban("TOO SLOW");
  }

 },120);
}

// ===== 8BIT ARTS =====
const TROPHY=`
<div class='art win'>
   ______________
  |  YOU WIN!!  |
  |           |
  |_____________|
</div>`;

const BEER=`
<div class='art lose'>
   _______
  | DRINK |
  |     |
  |_______|
</div>`;

const CRY=`
<div class='art korban'>
   _________
  | KORBAN |
  |      |
  |_______ |
</div>`;

// ===== ENDINGS =====
function korban(r){
 clearInterval(barTimer);

 show(CRY+
 "HAHA YOU IS 拽专\n"+
 r+
 "\n\nCOMMAND:\nMAKE STUPID MISSION");

 renderButtons([
  {t:"NEW GAME",ok:true}
 ]);

 stage=-1;
}

function win(){
 show(TROPHY+
 "YOU WIN\nCOMPUTER 驻住\n\nCOMMAND:\nDRINK!");

 end();
}

function lose(){
 show(BEER+
 "APOLOGIES\nYOU ARE 驻住\n\nCOMMAND:\nDRINK!");

 end();
}

function end(){
 clearInterval(barTimer);

 renderButtons([
  {t:"NEW GAME",ok:true}
 ]);

 stage=-1;
}

// ===== INPUT =====
function handle(text,ok){

 if(stage===-1){
   start(); return;
 }

 if(!ok){
   korban("LANGUAGE ERROR");
   return;
 }

 next(text);
}

// ===== FLOW =====
function next(){

if(stage===0){
 show("PHASE 1\n"+
  (balbalot?" 专":" 拽专"));

 let w=balbalot?" 专":" 拽专";

 renderButtons([
  {t:w,ok:true},
  ...getDecoys(w).map(x=>({t:x,ok:false}))
 ]);

 startBar();
 stage=1;
 return;
}

if(stage===1){
 show("PHASE 2\n"+
  (balbalot?"住驻专 专":"住驻专 拽专"));

 let w=balbalot?"住驻专 专":"住驻专 拽专";

 renderButtons([
  {t:w,ok:true},
  ...getDecoys(w).map(x=>({t:x,ok:false}))
 ]);

 startBar();
 stage=2;
 return;
}

if(stage===2){
 show("CHANT\n"+
  (balbalot?
   "   专":
   "   拽专"));

 let w=balbalot?
   "   专":
   "   拽专";

 renderButtons([
  {t:w,ok:true},
  {t:"  拽专",ok:false},
  {t:"  专",ok:false}
 ]);

 startBar();
 stage=3;
 return;
}

if(stage===3){
 enterArena();
 return;
}

if(stage===4){
 show("转拽 转拽");

 renderButtons([
  {t:"转拽 转拽",ok:true},
  ...getDecoys("转拽 转拽")
   .map(x=>({t:x,ok:false}))
 ]);

 startBar();
 stage=0;
 return;
}

if(stage===99){
 show("SUDDEN DEATH\n驻专 注住");

 renderButtons([
  {t:"驻专 注住",ok:true},
  ...getDecoys("驻专 注住")
   .map(x=>({t:x,ok:false}))
 ]);

 startBar();
 stage=100;
 return;
}
}

// ===== ARENA =====
function enterArena(){

 show("ARENA ROUND "+round);

 let opts=balbalot?
  Object.keys(BAL):
  Object.keys(ARENA);

 renderButtons(
  opts.map(o=>({t:o,ok:true}))
 );

 startBar();
 stage=30;
}

// ===== START =====
function start(){
 stage=0;
 round=1;
 balbalot=false;
 barSpeed=3;

 next();
}

start();
</script>
</body>
</html>
