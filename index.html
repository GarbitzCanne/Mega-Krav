<!DOCTYPE html>
<html dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>MEGA KRAV: BROFORCE EDITION</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
:root { --neon: #39ff14; --danger: #ff0033; --warn: #ffcc00; --bg: #0a0a0a; }

body { background: #000; color: var(--neon); font-family: 'VT323', monospace; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; text-transform: uppercase; }

/* CRT EFFECTS */
body::before { content: " "; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03)); z-index: 100; background-size: 100% 3px, 3px 100%; pointer-events: none; }

#app { width: 95%; max-width: 460px; background: var(--bg); padding: 15px; border: 4px solid var(--neon); box-shadow: 0 0 20px rgba(57, 255, 20, 0.5); position: relative; z-index: 5; text-align: center; }
#screen { border: 2px solid #113311; background: #000; padding: 10px; min-height: 280px; font-size: 24px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center; white-space: pre; }
#timeBarBox { width: 100%; height: 12px; background: #111; border: 1px solid var(--neon); margin-bottom: 10px; }
#timeBar { height: 100%; width: 100%; background: var(--neon); transition: width 0.1s linear; }

.btn { display: block; width: 100%; margin: 4px 0; padding: 10px; background: #111; color: var(--neon); border: 2px solid var(--neon); font-family: 'VT323'; font-size: 20px; cursor: pointer; transition: 0.1s; }
.btn:hover { background: var(--neon); color: #000; }
.btn:active { transform: translateY(2px); }

.korban { color: var(--danger); font-size: 50px; text-shadow: 0 0 10px red; animation: shake 0.1s infinite; }
@keyframes shake { 0%, 100% { transform: translate(0,0); } 25% { transform: translate(2px, 2px); } 75% { transform: translate(-2px, -2px); } }
pre { font-size: 12px; line-height: 1; color: var(--warn); }
.amos-sprite { width: 100px; border: 2px solid red; filter: grayscale(1) contrast(2); }
</style>
</head>

<body>
<div id="app">
    <div style="font-size:12px; opacity:0.7">BROFORCE AUDIO SYSTEM // ONLINE</div>
    <div id="timeBarBox"><div id="timeBar"></div></div>
    <div id="screen"></div>
    <div id="buttons"></div>
</div>

<script>
// --- BROFORCE 16-BIT MUSIC SYNTH ---
const ctx = new (window.AudioContext || window.webkitAudioContext)();
let musicStarted = false;

function playMusic() {
    if (musicStarted) return;
    musicStarted = true;
    const tempo = 130;
    const step = 60 / tempo / 2;
    const sequence = [440, 0, 440, 440, 349, 0, 392, 0, 440, 0, 440, 440, 523, 0, 493, 0]; // Driving bass/lead
    let i = 0;

    setInterval(() => {
        if (sequence[i] > 0) {
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.value = sequence[i] / 2;
            gain.gain.setValueAtTime(0.05, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.2);
            osc.connect(gain); gain.connect(ctx.destination);
            osc.start(); osc.stop(ctx.currentTime + 0.2);
        }
        i = (i + 1) % sequence.length;
    }, step * 1000);
}

// --- DATA ---
const MOVES = {
    NORMAL: ["בונגלו", "פיירבול", "צונמי", "אונייה"],
    BAL: ["לונגבו", "פיירדד", "נוצמי", "אוווניה"]
};
const ART = {
    SWORD: `    /\\\n   /  \\\n   |  |\n   |  |\n --|  |--\n   \\__/`,
    BOMB: `     _._\n    (_|_)\n     | |\n   .-' '-.\n   '-----'`
};

let stage=0, round=1, balbalot=false, barTimer, barWidth=100, pChoice, cChoice, suddenActive=false;
const $ = id => document.getElementById(id);

function getWinner(m1, m2, isBal) {
    const list = isBal ? MOVES.BAL : MOVES.NORMAL;
    const wins = [[list[0], list[3]], [list[1], list[0]], [list[2], list[1]], [list[3], list[2]]];
    return wins.some(p => p[0] === m1 && p[1] === m2);
}

function resolve() {
    const pW = getWinner(pChoice, cChoice, balbalot);
    const cW = getWinner(cChoice, pChoice, balbalot);
    if (pW) { show("ROUND CLEARED!"); stage = -1; btns([{t:"המשך", ok:true}]); }
    else if (cW) { triggerKorban("הובסת בקרב! שתה בירה."); }
    else {
        round++;
        if (round === 3) balbalot = true;
        if (round >= 4) { sudden(); return; }
        stage = 4; next();
    }
}

function next() {
    const W = balbalot ? {c:"מגה חרב", a:"סופר חרב", ch:"מגה מגה מגה חרב"} : {c:"מגה קרב", a:"סופר קרב", ch:"מגה מגה מגה קרב"};
    
    if (stage === 0) {
        show(`<pre>${ART.SWORD}</pre>${W.c}`);
        btns([{t:W.c, ok:true}, {t:"מגע קרב", ok:false}, {t:"מגה גרב", ok:false}, {t:"מפה חרב", ok:false}]);
        startBar(80); stage = 1;
    } else if (stage === 1) {
        show(`${W.a}`);
        btns([{t:W.a, ok:true}, {t:"סופר כרב", ok:false}, {t:"סופר קרפ", ok:false}, {t:"סופר סרב", ok:false}]);
        startBar(80); stage = 2;
    } else if (stage === 2) {
        show(`${W.ch}`);
        btns([{t:W.ch, ok:true}, {t:"מגה מגה קרב", ok:false}, {t:"מגה מגה מגה קרב", ok:false}, {t:"מגה מגה מגה כרב", ok:false}]);
        startBar(60); stage = 3;
    } else if (stage === 3) {
        show(`ROUND ${round}\nGO!!`);
        btns((balbalot ? MOVES.BAL : MOVES.NORMAL).map(m => ({t:m, ok:true})));
        startBar(120); stage = 30;
    } else if (stage === 4) {
        show("TEKO TEKO!");
        btns([{t:"תיקו תיקו", ok:true}, {t:"טיקו טיקו", ok:false}]);
        startBar(80); stage = 5;
    } else if (stage === 5) {
        stage = 0; next();
    }
}

function triggerKorban(msg) {
    clearInterval(barTimer);
    show(`<div class="korban">קורבן!</div>\n${msg}`);
    stage = -1;
    btns([{t:"נסה שוב, קורבן", ok:true}]);
}

function press(t, ok) {
    if (stage === -1) { start(); return; }
    if (!ok) { triggerKorban("קלט שגוי!"); return; }
    if (stage === 100) { suddenActive = false; stage = -1; show("VICTORY!\nניצחת את עמוס"); btns([{t:"שחק שוב", ok:true}]); return; }
    if (stage === 30) {
        clearInterval(barTimer); pChoice = t;
        cChoice = (balbalot?MOVES.BAL:MOVES.NORMAL)[Math.floor(Math.random()*4)];
        show(`אתה: ${pChoice}\nVS\nיריב: ${cChoice}`);
        setTimeout(resolve, 800);
        return;
    }
    next();
}

function startBar(speed) {
    clearInterval(barTimer); barWidth = 100;
    barTimer = setInterval(() => {
        barWidth -= 2; $("timeBar").style.width = barWidth + "%";
        if (barWidth <= 0) triggerKorban("איטי מדי!");
    }, speed);
}

function sudden() {
    show(`!!! SUDDEN DEATH !!!\n<img src="https://img.mako.co.il/2016/05/26/petiber_i.jpg" class="amos-sprite">\nעמוס פטיבר!`);
    suddenActive = true;
    setTimeout(() => { if (suddenActive) triggerKorban("עמוס שתה אותך!"); }, 1800);
    btns([{t:"פטיבר עמוס", ok:true}, {t:"פתיבר אמוס", ok:false}]);
    stage = 100;
}

function btns(arr) {
    // Shuffling removed as per instructions
    $("buttons").innerHTML = arr.map(b => `<button class='btn' onclick="press('${b.t}', ${b.ok})">${b.t}</button>`).join("");
}

function start() { stage = 0; round = 1; balbalot = false; next(); }

show(`<pre>${ART.BOMB}</pre>MEGA KRAV X\n\n[CLICK TO FIGHT]`);
document.addEventListener("click", () => {
    if(ctx.state === 'suspended') ctx.resume();
    playMusic();
    start();
}, { once: true });
</script>
</body>
</html>
