<!DOCTYPE html>
<html dir="rtl">
<head>
<meta charset="utf-8"/>

<!-- קריטי למובייל -->
<meta name="viewport"
 content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>

<title>MEGA KRAV MOBILE</title>

<style>
html,body{
  margin:0;
  padding:0;
  background:#050505;
  color:#33ff33;
  font-family:"Courier New",monospace;

  /* מונע זום דאבל טאפ */
  touch-action:manipulation;
}

#cabinet{
  max-width:480px;
  margin:auto;
  padding:10px;

  /* safe area לאייפון */
  padding-bottom: env(safe-area-inset-bottom);
}

#screen{
  border:2px solid #117711;
  background:#001100;
  padding:12px;
  min-height:22vh;

  font-size:18px;
  line-height:1.3;

  margin-bottom:8px;
  white-space:pre-line;
}

/* ===== כפתורי ענק לאצבע ===== */
.btn{
  display:block;
  width:100%;

  background:#002200;
  color:#33ff33;

  border:2px solid #33ff33;
  border-radius:10px;

  margin:6px 0;
  padding:16px;

  font-size:22px;
  text-align:center;

  /* מרגיש כמו אפליקציה */
  user-select:none;
}

.btn:active{
  background:#004400;
  transform:scale(0.97);
}

#timer{
  font-size:24px;
  text-align:center;
  margin:6px;
}

.title{
  text-align:center;
  letter-spacing:2px;
  margin:6px;
}

/* במכשירים ממש קטנים */
@media(max-width:360px){
 .btn{font-size:20px;padding:14px;}
 #screen{font-size:16px;}
}
</style>
</head>

<body>

<div id="cabinet">

<h2 class="title">MEGA KRAV POCKET</h2>

<div id="timer">TIME: --</div>

<div id="screen">INSERT COIN</div>

<div id="buttons"></div>

</div>

<script>
// ===== AUDIO =====
function beep(){
 try{
  let a=new AudioContext();
  let o=a.createOscillator();
  o.type="square";
  o.frequency.value=600;
  o.connect(a.destination);
  o.start();
  setTimeout(()=>o.stop(),70);
 }catch(e){}
}

// ===== DATA =====
let stage=0, speed=6, round=1, balbalot=false;
let timer,timeLeft;
let pMove,cMove;

const arena={
 "בונגלו":"אוניה",
 "פיירבול":"בונגלו",
 "צונמי":"פיירבול",
 "אוניה":"צונמי"
};

const balArena={
 "לונגבו":"אוווניה",
 "פיירדד":"לונגבו",
 "נוצמי":"פיירדד",
 "אוווניה":"נוצמי"
};

// ===== DECOYS =====
function makeDecoys(word){
 let d=new Set();

 d.add(word.replace(/ו/g,"וו"));
 d.add(word.replace(/י/g,"יי"));
 d.add(word.replace(/ב/g,"פ"));
 d.add(word.replace(/ק/g,"כ"));
 d.add(word.split("").reverse().join(""));

 d.delete(word);
 return Array.from(d);
}

function buttonsWithTraps(correct){
 let arr=[{t:correct,ok:true}];

 makeDecoys(correct)
  .slice(0,3)
  .forEach(x=>arr.push({t:x,ok:false}));

 arr=arr.sort(()=>Math.random()-0.5);

 let h="";
 arr.forEach(b=>{
  h+=`<div class='btn'
        onclick="pressTrap('${b.t}',${b.ok})">
        ${b.t}
      </div>`;
 });

 document.getElementById("buttons").innerHTML=h;
}

function pressTrap(text,ok){
 beep();
 if(!ok){
   korban("LANGUAGE ERROR");
   return;
 }
 game(text);
}

// ===== TIMER =====
function startTimer(){
 clearInterval(timer);
 timeLeft=speed;

 document.getElementById("timer").innerText=
   "TIME: "+timeLeft;

 timer=setInterval(()=>{
  timeLeft--;
  document.getElementById("timer").innerText=
    "TIME: "+timeLeft;

  if(timeLeft<=0)
    korban("HUMAN TOO SLOW");

 },1000);
}

// ===== UI =====
function screen(t){
 document.getElementById("screen").innerText=t;
}

function korban(r){
 clearInterval(timer);
 screen("HAHA YOU IS קורבן\n"+r);

 document.getElementById("buttons").innerHTML=
 `<div class='btn' onclick='start()'>
    NEW GAME
  </div>`;
}

// ===== FLOW =====
function game(input){

if(stage===0){
 screen("PHASE 1\n"+
   (balbalot?"מגה חרב":"מגה קרב"));

 buttonsWithTraps(
   balbalot?"מגה חרב":"מגה קרב"
 );

 startTimer();
 stage=1;
 return;
}

if(stage===1){
 screen("PHASE 2\n"+
   (balbalot?"סופר חרב":"סופר קרב"));

 buttonsWithTraps(
   balbalot?"סופר חרב":"סופר קרב"
 );

 startTimer();
 stage=2;
 return;
}

if(stage===2){
 screen("CHANT\n"+
   (balbalot?
    "מגה מגה מגה חרב":
    "מגה מגה מגה קרב"));

 buttonsWithTraps(
   balbalot?
   "מגה מגה מגה חרב":
   "מגה מגה מגה קרב"
 );

 startTimer();
 stage=3;
 return;
}

// ===== ARENA =====
if(stage===3){

 screen("ARENA ROUND "+round);

 let opts=balbalot?
  ["לונגבו","פיירדד","נוצמי","אוווניה"]:
  ["בונגלו","פיירבול","צונמי","אוניה"];

 let h="";
 opts.forEach(o=>{
  h+=`<div class='btn'
       onclick="arenaSelect('${o}')">
       ${o}
     </div>`;
 });

 document.getElementById("buttons").innerHTML=h;

 startTimer();
 stage=30;
 return;
}

if(stage===4){
 screen("תיקו תיקו");
 buttonsWithTraps("תיקו תיקו");
 startTimer();
 stage=0;
 return;
}

if(stage===99){
 screen("SUDDEN DEATH\nפטיבר עמוס");
 buttonsWithTraps("פטיבר עמוס");
 startTimer();
 stage=100;
 return;
}

if(stage===100){
 screen("YOU WIN\nCOMPUTER מפסידן");
 end();
}
}

// ===== ARENA LOGIC =====
function arenaSelect(move){
 clearInterval(timer);
 pMove=move;

 let opts=balbalot?
  ["לונגבו","פיירדד","נוצמי","אוווניה"]:
  ["בונגלו","פיירבול","צונמי","אוניה"];

 cMove=opts[
  Math.floor(Math.random()*opts.length)
 ];

 screen("YOU: "+pMove+"\nCPU: "+cMove);

 setTimeout(resolve,700);
}

function resolve(){
 let table=balbalot?balArena:arena;

 if(pMove===cMove){teko();return;}

 if(table[pMove]===cMove) win();
 else if(table[cMove]===pMove) lose();
 else teko();
}

function win(){
 screen("YOU WIN\nCOMPUTER מפסידן");
 end();
}

function lose(){
 screen("APOLOGIES\nYOU ARE מפסידן");
 end();
}

function teko(){
 round++;

 if(round===3){
  balbalot=true;
  screen("שלב הבלבלות");
 }

 if(round>=4){
  screen("תיקן תיקו\nSUDDEN DEATH");
  stage=99;
  game();
  return;
 }

 speed=Math.max(2,speed-1);

 screen("תיקו תיקו\nROUND "+round);
 stage=4;
 game();
}

function end(){
 clearInterval(timer);

 document.getElementById("buttons").innerHTML=
 `<div class='btn' onclick='start()'>
   NEW GAME
  </div>`;
}

// ===== START =====
function start(){
 stage=0; round=1; speed=6; balbalot=false;
 game();
}

start();
</script>
</body>
</html>
