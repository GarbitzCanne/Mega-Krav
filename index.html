<!DOCTYPE html>
<html dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>MEGA KRAV ARCADE: TURBO</title>

<style>
:root{--neon:#33ff33;--bg:#050a05;}
body{
 background:#000;color:var(--neon);
 font-family:'Courier New',monospace;
 margin:0;display:flex;justify-content:center;align-items:center;
 height:100vh;text-transform:uppercase;
}
#app{
 width:100%;max-width:440px;
 background:var(--bg);padding:15px;
 border:4px solid #222;text-align:center;
}
#timeBarBox{width:100%;height:14px;background:#001100;border:2px solid var(--neon);}
#timeBar{height:100%;width:100%;background:var(--neon);}
#screen{
 border:2px solid #113311;background:#000;
 padding:20px;min-height:240px;margin-bottom:12px;
 display:flex;flex-direction:column;justify-content:center;align-items:center;
}
.btn{
 display:block;width:100%;margin:8px 0;
 padding:16px;background:#1a331a;color:var(--neon);
 border:none;border-bottom:5px solid #0a1a0a;
}
.sprite{font-size:50px;margin-bottom:10px;}
</style>
</head>

<body>
<div id="app">
<div id="timeBarBox"><div id="timeBar"></div></div>
<div id="screen"></div>
<div id="buttons"></div>
</div>

<script>
// ===== STATE =====
let stage=0, round=1, balbalot=false, lock=false;
let barTimer=null, barWidth=100;
let p,c;

// ===== TABLES =====
const ARENA={ "×‘×•× ×’×œ×•":"××•× ×™×”","×¤×™×™×¨×‘×•×œ":"×‘×•× ×’×œ×•","×¦×•× ××™":"×¤×™×™×¨×‘×•×œ","××•× ×™×”":"×¦×•× ××™" };
const BAL  ={ "×œ×•× ×’×‘×•":"××•×•×•× ×™×”","×¤×™×™×¨×“×“":"×œ×•× ×’×‘×•","× ×•×¦××™":"×¤×™×™×¨×“×“","××•×•×•× ×™×”":"× ×•×¦××™" };

const WORDS={
 normal:{challenge:"××’×” ×§×¨×‘",accept:"×¡×•×¤×¨ ×§×¨×‘",chant:"××’×” ××’×” ××’×” ×§×¨×‘"},
 bal:{challenge:"××’×” ×—×¨×‘",accept:"×¡×•×¤×¨ ×—×¨×‘",chant:"××’×” ××’×” ××’×” ×—×¨×‘"}
};

const DECOY={
 "××’×” ×§×¨×‘":["××’×” ×§×¨××‘","××’×¢ ×§×¨×‘"],
 "×¡×•×¤×¨ ×§×¨×‘":["×¡×•×¤×¨ ×§×¨××‘","×¡×•×¤ ×§×¨×‘"],
 "××’×” ××’×” ××’×” ×§×¨×‘":["××’×” ××’×” ×§×¨×‘"],
 "×¤×˜×™×‘×¨ ×¢××•×¡":["×¤×˜×™×‘×¨ ×××•×¡"]
};

function decoys(w){
 let d=[...(DECOY[w]||[])];
 while(d.length<2) d.push(w+"X");
 return [...new Set(d)].slice(0,2);
}

// ===== UI =====
const $=id=>document.getElementById(id);
function show(h){$("screen").innerHTML=h;}

function buttons(arr){
 if(lock) return;
 $("buttons").innerHTML=arr.map(b=>
  `<button class='btn' onclick="press('${b.t}',${b.ok})">${b.t}</button>`
 ).join("");
}

// ===== TIMER =====
function startBar(){
 clearInterval(barTimer); barWidth=100;
 barTimer=setInterval(()=>{
  barWidth-=3; $("timeBar").style.width=barWidth+"%";
  if(barWidth<=0) korban("× ×’××¨ ×”×–××Ÿ");
 },120);
}
function stopBar(){clearInterval(barTimer);}

// ===== ENDINGS =====
function korban(r){
 stopBar(); lock=true;
 show(`<div class="sprite">ğŸ’€</div>×§×•×¨×‘×Ÿ!<br>${r}`);
 setTimeout(()=>buttons([{t:"×—×“×©",ok:true}]),1000);
 stage=-1;
}
function win(){
 stopBar(); lock=true;
 show(`<div class="sprite">ğŸ‘</div>× ×™×¦×—×•×Ÿ!`);
 setTimeout(()=>buttons([{t:"×©×•×‘",ok:true}]),1200);
 stage=-1;
}
function lose(){
 stopBar(); lock=true;
 show(`<div class="sprite">ğŸº</div>××¤×¡×™×“×Ÿ!`);
 setTimeout(()=>buttons([{t:"×©×•×‘",ok:true}]),1200);
 stage=-1;
}

// ===== INPUT HANDLER â€“ FIXED =====
function press(t,ok){
 if(stage===-1){ start(); return; }
 if(!ok){ korban("×˜×¢×•×ª"); return; }

 // â˜…â˜… ×”×§×¨×™×˜×™ â˜…â˜…
 if(stage===30){
   fight(t);
   return;
 }

 next();
}

// ===== FLOW =====
function next(){
 lock=false;
 const W=balbalot?WORDS.bal:WORDS.normal;

 switch(stage){

 case 0:
   show(W.challenge);
   buttons([{t:W.challenge,ok:true},...decoys(W.challenge).map(x=>({t:x,ok:false}))]);
   startBar(); stage=1; break;

 case 1:
   show(W.accept);
   buttons([{t:W.accept,ok:true},...decoys(W.accept).map(x=>({t:x,ok:false}))]);
   startBar(); stage=2; break;

 case 2:
   show(W.chant);
   buttons([{t:W.chant,ok:true},...decoys(W.chant).map(x=>({t:x,ok:false}))]);
   startBar(); stage=3; break;

 case 3:
   enterArena(); break;

 case 4:
   show("×ª×™×§×•!");
   buttons([{t:"×ª×™×§×• ×ª×™×§×•",ok:true},{t:"×˜×™×§×•",ok:false}]);
   startBar(); stage=5; break;

 case 5:
   stage=0; next(); break;
 }
}

// ===== ARENA =====
function enterArena(){
 show(`××¨× ×” ×¡×™×‘×•×‘ ${round}`);
 let opts=Object.keys(balbalot?BAL:ARENA);
 buttons(opts.map(o=>({t:o,ok:true})));
 startBar(); stage=30;
}

// â˜…â˜… ×”×§×¨×‘ ×”×××™×ª×™ â˜…â˜…
function fight(sel){
 stopBar(); lock=true;
 p=sel;

 let opts=Object.keys(balbalot?BAL:ARENA);
 c=opts[Math.random()*opts.length|0];

 show(`××ª×”: ${p}<br>CPU: ...`);
 setTimeout(()=>{
   show(`××ª×”: ${p}<br>CPU: ${c}`);
   setTimeout(resolve,800);
 },600);
}

function resolve(){
 let T=balbalot?BAL:ARENA;

 if(p===c){
   round++;
   if(round===3) balbalot=true;

   if(round>=4){
     sudden(); return;
   }

   stage=4; next(); return;
 }

 (T[p]===c)?win():lose();
}

// ===== SUDDEN DEATH =====
function sudden(){
 show("×¤×˜×™×‘×¨ ×¢××•×¡!");
 buttons([{t:"×¤×˜×™×‘×¨ ×¢××•×¡",ok:true},...decoys("×¤×˜×™×‘×¨ ×¢××•×¡").map(x=>({t:x,ok:false}))]);
 startBar(); stage=100;
}

// ===== START =====
function start(){
 stage=0; round=1; balbalot=false; lock=false;
 next();
}

show("×œ×—×¥ ×œ×”×ª×—×™×œ");
document.addEventListener("click",()=>start(),{once:true});
</script>
</body>
</html>
