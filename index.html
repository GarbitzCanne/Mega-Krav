<!DOCTYPE html>
<html dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>MEGA KRAV: AMOS NERFED EDITION</title>

<style>
:root { --neon: #33ff33; --bg: #050a05; }
body { background: #000; color: var(--neon); font-family: 'Courier New', monospace; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; text-transform: uppercase; }
#app { width: 100%; max-width: 440px; background: var(--bg); padding: 15px; border: 4px solid #222; box-shadow: 0 0 30px rgba(0,255,0,0.2); position: relative; z-index: 5; text-align: center; }
#timeBarBox { width: 100%; height: 14px; background: #001100; border: 2px solid var(--neon); margin-bottom: 12px; }
#timeBar { height: 100%; width: 100%; background: var(--neon); transition: width 0.05s linear; }
#screen { border: 2px solid #113311; background: #000; padding: 20px; min-height: 250px; font-size: 22px; margin-bottom: 12px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
.amos-sprite { width: 140px; border: 2px solid var(--neon); margin: 10px 0; filter: contrast(1.2) sepia(1) hue-rotate(60deg); }
.btn { display: block; width: 100%; margin: 8px 0; padding: 16px; background: #1a331a; color: var(--neon); border: none; border-bottom: 5px solid #0a1a0a; border-radius: 4px; font-size: 18px; font-weight: bold; cursor: pointer; }
.btn:active { transform: translateY(3px); border-bottom: 1px solid #0a1a0a; }
.flash-yellow { animation: f-yellow 0.15s 2; }
@keyframes f-yellow { 0%, 100% { background: #000; } 50% { background: #aa8800; } }
.shake { animation: shake 0.2s infinite; }
@keyframes shake { 0%, 100% { transform: translate(2px, 2px); } 50% { transform: translate(-2px, -2px); } }
</style>
</head>

<body>
<div id="app">
<div id="logo">MEGA KRAV ARCADE 2026</div>
<div id="timeBarBox"><div id="timeBar"></div></div>
<div id="screen"></div>
<div id="buttons"></div>
</div>

<script>
// --- DATA ---
const MOVES = {
  NORMAL: ["בונגלו", "פיירבול", "צונמי", "אונייה"],
  BAL: ["לונגבו", "פיירדד", "נוצמי", "אוווניה"]
};

// --- LOGIC ---
function getWinner(m1, m2, isBal) {
  const list = isBal ? MOVES.BAL : MOVES.NORMAL;
  const winPairs = [
    [list[0], list[3]], // Bungalo > Onyia
    [list[1], list[0]], // Fireball > Bungalo
    [list[2], list[1]], // Tsunami > Fireball
    [list[3], list[2]]  // Onyia > Tsunami
  ];
  return winPairs.some(pair => pair[0] === m1 && pair[1] === m2);
}

// --- STATE ---
let stage=0, round=1, balbalot=false, lock=false, barTimer, barWidth=100, pChoice, cChoice, suddenActive=false;
const $ = id => document.getElementById(id);

function resolve() {
  const playerWins = getWinner(pChoice, cChoice, balbalot);
  const cpuWins = getWinner(cChoice, pChoice, balbalot);

  if (playerWins) {
    win();
  } else if (cpuWins) {
    lose();
  } else {
    // TEKO TEKO Logic
    round++;
    $("screen").classList.add("flash-yellow");
    setTimeout(() => $("screen").classList.remove("flash-yellow"), 300);
    if (round === 3) balbalot = true;
    if (round >= 4) { sudden(); return; }
    stage = 4; 
    next();
  }
}

// --- FLOW ---
function next() {
  const W = balbalot 
    ? { chal: "מגה חרב", acc: "סופר חרב", chant: "מגה מגה מגה חרב" } 
    : { chal: "מגה קרב", acc: "סופר קרב", chant: "מגה מגה מגה קרב" };

  if (stage === 0) {
    show(W.chal);
    btns([{ t: W.chal, ok: true }, { t: "מגע קרב", ok: false }]);
    startBar(); stage = 1;
  } else if (stage === 1) {
    show(W.acc);
    btns([{ t: W.acc, ok: true }, { t: "סופר כרב", ok: false }]);
    startBar(); stage = 2;
  } else if (stage === 2) {
    show(W.chant);
    btns([{ t: W.chant, ok: true }, { t: "מגה מגה קרב", ok: false }]);
    startBar(); stage = 3;
  } else if (stage === 3) {
    show(`ARENA ROUND ${round}<br>בחר מהלך!`);
    btns((balbalot ? MOVES.BAL : MOVES.NORMAL).map(m => ({ t: m, ok: true })));
    startBar(); stage = 30;
  } else if (stage === 4) {
    show("TEKO TEKO!");
    btns([{ t: "תיקו תיקו", ok: true }, { t: "טיקו תיקו", ok: false }]);
    startBar(); stage = 5;
  } else if (stage === 5) {
    stage = 0; next();
  }
}

function press(t, ok) {
  if (stage === -1) { start(); return; }
  if (!ok) { gameOver("טעות בקלט!"); return; }
  if (stage === 100) { suddenActive = false; stopBar(); win(); return; }
  
  if (stage === 30) {
    stopBar(); pChoice = t;
    const currentMoves = balbalot ? MOVES.BAL : MOVES.NORMAL;
    cChoice = currentMoves[Math.floor(Math.random() * 4)];
    show(`אתה: ${pChoice}<br>יריב: <span class="shake">...</span>`);
    setTimeout(() => {
      show(`אתה: ${pChoice}<br>יריב: ${cChoice}`);
      setTimeout(resolve, 800);
    }, 600);
    return;
  }
  next();
}

// --- ENGINE ---
function startBar() {
  clearInterval(barTimer); barWidth = 100;
  barTimer = setInterval(() => {
    barWidth -= 2; // Slower bar decay
    $("timeBar").style.width = barWidth + "%";
    if (barWidth <= 0) gameOver("איטי מדי!");
  }, 100);
}
function stopBar() { clearInterval(barTimer); }
function show(h) { $("screen").innerHTML = h; }
function btns(arr) { 
  $("buttons").innerHTML = arr.map(b => `<button class='btn' onclick="press('${b.t}', ${b.ok})">${b.t}</button>`).join(""); 
}

function win() { show("NICE!<br>ניצחת את הסיבוב"); stage = -1; btns([{ t: "עוד פעם?", ok: true }]); }
function lose() { show("LOSE!<br>לך לשתות בירה"); stage = -1; btns([{ t: "נסה שוב", ok: true }]); }
function gameOver(msg) { stopBar(); show(`GAME OVER<br>${msg}`); stage = -1; btns([{ t: "אתחול", ok: true }]); }

function sudden() {
  show(`!!! SUDDEN DEATH !!!<br><img src="https://img.mako.co.il/2016/05/26/petiber_i.jpg" class="amos-sprite"><br>עמוס פטיבר הופיע!`);
  suddenActive = true;
  // Amos is now slower (1.8 seconds instead of 0.7)
  let reactionTime = 1800; 
  setTimeout(() => { if (suddenActive) lose(); }, reactionTime);
  btns([{ t: "פטיבר עמוס", ok: true }, { t: "פתיבר אמוס", ok: false }]);
  stage = 100;
}

function start() { stage = 0; round = 1; balbalot = false; next(); }

show("MEGA KRAV X<br>לחץ להתחלה");
document.addEventListener("click", () => start(), { once: true });
</script>
</body>
</html>
