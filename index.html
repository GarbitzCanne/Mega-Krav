<!DOCTYPE html>
<html dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport"
 content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>

<title>Mega Krav Mobile</title>

<style>
body{
 background:#050505;
 color:#33ff33;
 font-family:monospace;
 margin:0;
}

#app{
 max-width:480px;
 margin:auto;
 padding:10px;
}

#screen{
 border:2px solid #117711;
 background:#001100;
 padding:12px;
 min-height:22vh;
 white-space:pre-line;
 font-size:18px;
}

.btn{
 display:block;
 width:100%;
 margin:6px 0;
 padding:16px;

 background:#002200;
 color:#33ff33;

 border:2px solid #33ff33;
 border-radius:10px;

 font-size:22px;
}

#timer{
 text-align:center;
 font-size:24px;
}
</style>
</head>

<body>
<div id="app">

<div id="timer">TIME</div>
<div id="screen"></div>
<div id="buttons"></div>

</div>

<script>
// ===== STATE =====
let stage = 0;
let round = 1;
let balbalot = false;
let speed = 6;

let timer, timeLeft;

let playerMove, cpuMove;

// ===== DATA =====
const ARENA = {
 "בונגלו":"אוניה",
 "פיירבול":"בונגלו",
 "צונמי":"פיירבול",
 "אוניה":"צונמי"
};

const BAL = {
 "לונגבו":"אוווניה",
 "פיירדד":"לונגבו",
 "נוצמי":"פיירדד",
 "אוווניה":"נוצמי"
};

// ===== SAFE DECOYS – NEVER IDENTICAL =====
const DECOY_BANK = {
 "מגה קרב":["מגה קראב","מגה קרבה","מגע קרב"],
 "סופר קרב":["סופר קראב","סופ קרב","סופר כרב"],
 "מגה חרב":["מגה חרבה","מגע חרב","מגה חראב"],
 "סופר חרב":["סופר חרבה","סופר חראב","סופ חרב"],
 "תיקו תיקו":["טיקו תיקו","תיקו תיק","טיקו טיקו"],
 "פטיבר עמוס":["פטיבר אמוס","פטיבר עמוש","פתיבר עמוס"]
};

function getDecoys(word){
 return DECOY_BANK[word] || [
   word+"!",
   word.split("").reverse().join(""),
   word+"?"
 ];
}

// ===== RENDER =====
function show(t){
 document.getElementById("screen").innerText=t;
}

function renderButtons(list){
 let h="";
 list.forEach(b=>{
  h+=`<div class='btn'
       onclick="handle('${b.t}',${b.ok})">
       ${b.t}
      </div>`;
 });
 document.getElementById("buttons").innerHTML=h;
}

// ===== TIMER =====
function startTimer(){
 clearInterval(timer);
 timeLeft=speed;

 document.getElementById("timer").innerText=
   "TIME: "+timeLeft;

 timer=setInterval(()=>{
  timeLeft--;
  document.getElementById("timer").innerText=
   "TIME: "+timeLeft;

  if(timeLeft<=0)
    korban("TOO SLOW");

 },1000);
}

// ===== KORBAN =====
function korban(r){
 clearInterval(timer);

 show("HAHA YOU IS קורבן\n"+r);

 renderButtons([
  {t:"NEW GAME",ok:true}
 ]);

 stage=-1;
}

// ===== INPUT HANDLER =====
function handle(text, ok){

 if(stage===-1){
   start();
   return;
 }

 if(!ok){
   korban("LANGUAGE ERROR");
   return;
 }

 next(text);
}

// ===== FLOW CONTROLLER =====
function next(input){

// 0 – CHALLENGE
if(stage===0){
 show("PHASE 1\n"+
  (balbalot?"מגה חרב":"מגה קרב"));

 let w=balbalot?"מגה חרב":"מגה קרב";

 renderButtons([
  {t:w, ok:true},
  ...getDecoys(w).map(x=>({t:x,ok:false}))
 ]);

 startTimer();
 stage=1;
 return;
}

// 1 – ACCEPT
if(stage===1){
 show("PHASE 2\n"+
  (balbalot?"סופר חרב":"סופר קרב"));

 let w=balbalot?"סופר חרב":"סופר קרב";

 renderButtons([
  {t:w, ok:true},
  ...getDecoys(w).map(x=>({t:x,ok:false}))
 ]);

 startTimer();
 stage=2;
 return;
}

// 2 – CHANT
if(stage===2){
 show("CHANT\n"+
  (balbalot?
   "מגה מגה מגה חרב":
   "מגה מגה מגה קרב"));

 let w=balbalot?
   "מגה מגה מגה חרב":
   "מגה מגה מגה קרב";

 renderButtons([
  {t:w, ok:true},
  {t:"מגה מגה קרב",ok:false},
  {t:"מגה מגה חרב",ok:false}
 ]);

 startTimer();
 stage=3;
 return;
}

// 3 – ARENA  ⭐ FIXED HERE ⭐
if(stage===3){
 enterArena();
 return;
}

// 4 – TEKO
if(stage===4){
 show("תיקו תיקו");

 renderButtons([
  {t:"תיקו תיקו",ok:true},
  ...getDecoys("תיקו תיקו")
    .map(x=>({t:x,ok:false}))
 ]);

 startTimer();
 stage=0;
 return;
}

// 99 – SUDDEN
if(stage===99){
 show("SUDDEN DEATH\nפטיבר עמוס");

 renderButtons([
  {t:"פטיבר עמוס",ok:true},
  ...getDecoys("פטיבר עמוס")
    .map(x=>({t:x,ok:false}))
 ]);

 startTimer();
 stage=100;
 return;
}

}

// ===== ARENA LOGIC =====
function enterArena(){

 show("ARENA ROUND "+round);

 let opts=balbalot?
  Object.keys(BAL):
  Object.keys(ARENA);

 // ⭐ NO DECOYS IN ARENA ⭐
 renderButtons(
  opts.map(o=>({t:o,ok:true}))
 );

 startTimer();
 stage=30;
}

function arenaSelect(move){
 playerMove=move;

 let opts=balbalot?
  Object.keys(BAL):
  Object.keys(ARENA);

 cpuMove=
  opts[Math.floor(Math.random()*opts.length)];

 resolve();
}

function resolve(){

 let table=balbalot?BAL:ARENA;

 if(playerMove===cpuMove){
  teko(); return;
 }

 if(table[playerMove]===cpuMove){
  win(); return;
 }

 lose();
}

function win(){
 show("YOU WIN\nCOMPUTER מפסידן");
 end();
}

function lose(){
 show("YOU ARE מפסידן");
 end();
}

function teko(){
 round++;

 if(round===3){
  balbalot=true;
  show("שלב הבלבלות");
 }

 if(round>=4){
  stage=99;
  next();
  return;
 }

 speed=Math.max(2,speed-1);

 show("תיקו תיקו\nROUND "+round);

 stage=4;
 next();
}

function end(){
 clearInterval(timer);

 renderButtons([
  {t:"NEW GAME",ok:true}
 ]);

 stage=-1;
}

// ===== START =====
function start(){
 stage=0;
 round=1;
 balbalot=false;
 speed=6;

 next();
}

start();
</script>
</body>
</html>
